<?php/** * SNAPSMACK - Preflight check. * Analyzes image signals for titles and EXIF metadata prior to final upload. * Facilitates the pre-population of post metadata for technical consistency. * Git Version Official Alpha 0.5 */require_once 'core/auth.php';// Ensure the response is handled as JSON for the frontend AJAX listener.header('Content-Type: application/json');if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['image_file'])) {    $file = $_FILES['image_file'];    $response = ['success' => false, 'meta' => [], 'title' => ''];    // --- 1. TITLE GENERATION ---    // Extract the filename and convert underscores/dashes to natural spaces.    $name = pathinfo($file['name'], PATHINFO_FILENAME);    $title = str_replace(['_', '-'], ' ', $name);         // Normalize spacing for a clean identifier.    $response['title'] = trim(preg_replace('/\s+/', ' ', $title));    // --- 2. EXIF DATA EXTRACTION ---    // EXIF metadata is primary to JPEG architecture; check mime type before extraction.    $mime = mime_content_type($file['tmp_name']);    if (in_array($mime, ['image/jpeg', 'image/jpg'])) {        $exif = @exif_read_data($file['tmp_name']);                if ($exif) {            // Map raw EXIF keys to SnapSmack internal metadata structure.            $response['meta'] = [                'camera'   => trim(($exif['Make'] ?? '') . ' ' . ($exif['Model'] ?? '')),                'iso'      => $exif['ISOSpeedRatings'] ?? '',                // Rational numbers (e.g. 28/10) are evaluated for decimal output.                'aperture' => isset($exif['FNumber']) ? "f/" . eval("return " . $exif['FNumber'] . ";") : '',                'shutter'  => $exif['ExposureTime'] ?? '',                'focal'    => isset($exif['FocalLength']) ? eval("return " . $exif['FocalLength'] . ";") . "mm" : '',                'flash'    => (isset($exif['Flash']) && ($exif['Flash'] & 1)) ? 'Yes' : 'No',                'date'     => $exif['DateTimeOriginal'] ?? ''            ];        }    }        $response['success'] = true;    echo json_encode($response);    exit;}